<template>
  <div id="__next">
    <div class="disabled-animation-modal"></div>
    <div class="z" id="training">
      <div class="z-body">
        <div class="page-header" id="marketplace">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <h2>
                  534 <span class="text-white">ZOANs In Challenge Mode</span>
                </h2>
                <h2>
                  1186 <span class="text-white">ZOANs In Career Mode</span>
                </h2>
                <h3>70 <span class="text-white">ZOANs In Duel Mode</span></h3>
              </div>
            </div>
          </div>
        </div>
        <div class="page-body">
          <div class="container">
            <div class="justify-content-center row">
              <div class="mb-4 col-sm-12 col-md-12 col-lg-12 col-xl-3">
                <div class="justify-content-center row">
                  <div class="col-sm-8 col-md-8 col-lg-6 col-xl-12">
                    <div class="market-search">
                      <div class="market-search__form form-group">
                        <input
                          placeholder="Search Your ZOANs..."
                          type="text"
                          class="form-control"
                        />
                      </div>
                      <div class="market-search__filter">
                        <div class="form-group">
                          <h5>Rare</h5>
                          <div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterRare1"
                                value="1"
                              /><label
                                class="filter-checkbox-label"
                                for="filterRare1"
                                >1</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterRare2"
                                value="2"
                              /><label
                                class="filter-checkbox-label"
                                for="filterRare2"
                                >2</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterRare3"
                                value="3"
                              /><label
                                class="filter-checkbox-label"
                                for="filterRare3"
                                >3</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterRare4"
                                value="4"
                              /><label
                                class="filter-checkbox-label"
                                for="filterRare4"
                                >4</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterRare5"
                                value="5"
                              /><label
                                class="filter-checkbox-label"
                                for="filterRare5"
                                >5</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterRare6"
                                value="6"
                              /><label
                                class="filter-checkbox-label"
                                for="filterRare6"
                                >6</label
                              >
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <h5>Level</h5>
                          <div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterLevel1"
                                value="1"
                              /><label
                                class="filter-checkbox-label"
                                for="filterLevel1"
                                >1</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterLevel2"
                                value="2"
                              /><label
                                class="filter-checkbox-label"
                                for="filterLevel2"
                                >2</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterLevel3"
                                value="3"
                              /><label
                                class="filter-checkbox-label"
                                for="filterLevel3"
                                >3</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterLevel4"
                                value="4"
                              /><label
                                class="filter-checkbox-label"
                                for="filterLevel4"
                                >4</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterLevel5"
                                value="5"
                              /><label
                                class="filter-checkbox-label"
                                for="filterLevel5"
                                >5</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterLevel6"
                                value="6"
                              /><label
                                class="filter-checkbox-label"
                                for="filterLevel6"
                                >6</label
                              >
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <h5>Tribe</h5>
                          <div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterTribe0"
                                value="0"
                              /><label
                                class="filter-checkbox-label"
                                for="filterTribe0"
                                >Skyler</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterTribe1"
                                value="1"
                              /><label
                                class="filter-checkbox-label"
                                for="filterTribe1"
                                >Hydrein</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterTribe2"
                                value="2"
                              /><label
                                class="filter-checkbox-label"
                                for="filterTribe2"
                                >Plasmer</label
                              >
                            </div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterTribe3"
                                value="3"
                              /><label
                                class="filter-checkbox-label"
                                for="filterTribe3"
                                >Stonic</label
                              >
                            </div>
                          </div>
                        </div>
                        <div class="form-group">
                          <h5>Egg</h5>
                          <div>
                            <div class="filter-checkbox">
                              <input
                                class="filter-checkbox-input"
                                type="checkbox"
                                id="filterEgg0"
                                value="0"
                              /><label
                                class="filter-checkbox-label"
                                for="filterEgg0"
                              ></label>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="market-search__suggest">
                        <button
                          type="button"
                          class="
                            search-suggest__btn
                            mb-1
                            btn btn-outline-primary btn-sm
                          "
                        >
                          Value sort:
                          <img
                            src="@/assets/images/p2pimages/img2.svg"
                            class="svg-inline--fa fa-sort-numeric-up fa-w-14"
                            style="fill: red"
                            alt=""
                          />
                          <!-- <svg>
        <use xlink:href='@/assets/images/p2pimages/img2.svg#img'></use>
      </svg> --></button
                        ><button
                          type="button"
                          class="search-suggest__btn ml-1 btn btn-buy btn-sm"
                        >
                          Reset
                        </button>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-4 col-md-4 col-lg-6 col-xl-12">
                    <div
                      class="card-boss__zoan card-boss__pk card"
                      @click="openHeroPicker()"
                      v-if="!characterId"
                    >
                      <div class="card-header">
                        <span
                          variant="primary"
                          class="badge badge-secondary badge-pill"
                          >#pick a Hero to Challenge</span
                        >
                      </div>
                      <img
                        src="@/assets/images/p2pimages/add-zoan.svg"
                        class="img-add-zoan card-img"
                      />
                    </div>
                    <div
                      v-if="characterId"
                      @click="openHeroPicker()"
                      class="character-item"
                    >
                      <div class="art">
                        <CharacterArt :character="selectedCharacter" />
                      </div>
                    </div>

                    <div
                      class="card-boss__zoan card-boss__pk card"
                      @click="openWeaponPicker()"
                      v-if="!selectedWeapon"
                    >
                      <div class="card-header">
                        <span
                          variant="primary"
                          class="badge badge-secondary badge-pill"
                          >#pick a Weapon to Challenge</span
                        >
                      </div>
                      <img
                        src="@/assets/images/p2pimages/add-zoan.svg"
                        class="img-add-zoan card-img"
                      />
                    </div>
                    <div class="weapon">
                      <div
                        class="weapon-icon-wrapper"
                        v-if="selectedWeapon"
                        @click="openWeaponPicker()"
                      >
                        <weapon-icon
                          :weapon="selectedWeapon"
                          class="weapon-icon"
                        />
                      </div>
                    </div>

                    <button
                      type="button"
                      class="search-suggest__btn ml-1 btn btn-buy btn-sm"
                      @click="handleCreateRoom()"
                    >
                      Create Room
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-lg-12 col-xl-9">
                <div class="justify-content-center mb-2 row">
                  <div class="text-center col-12">
                    <div
                      class="
                        zoon-custom-switch
                        custom-switch custom-switch-lg custom-control
                      "
                    >
                      <input
                        type="checkbox"
                        id="exampleCustomSwitch"
                        name="customSwitch"
                        class="custom-control-input"
                        checked=""
                      /><label
                        class="custom-control-label"
                        for="exampleCustomSwitch"
                        >Show your ZOANs</label
                      >
                    </div>
                  </div>
                </div>
                <div class="justify-content-center row">
                  <div class="text-center col-12">
                    <ul class="tab-categories nav nav-tabs">
                      <li class="nav-item">
                        <a class="nav-link active"
                          >Career Mode
                          <span class="badge badge-secondary badge-pill"
                            >1186</span
                          ></a
                        >
                      </li>
                      <li class="nav-item">
                        <a class="nav-link"
                          >Requests
                          <span class="badge badge-success badge-pill"
                            >534</span
                          ></a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
                <div
                  v-for="r in careerModeRooms"
                  :key="r.characterId"
                  class="justify-content-center row"
                >
                  <CharacterRoom
                    :characterId="r.characterId"
                    :room="r"
                    :selectedCharacterId="characterId"
                    :selectedWeaponId="weaponId"
                  />
                </div>

                <div class="justify-content-center row">
                  <div class="market-footer col-12">
                    <hr />
                    <div class="paging">
                      <div class="total-page">1/45</div>
                      <button type="button" class="mr-1 btn btn-secondary">
                        <img
                          src="@/assets/images/p2pimages/img3.svg"
                          class="svg-inline--fa fa-chevron-right fa-w-10"
                          alt=""
                        />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="Toastify"></div>
    <b-modal
      class="centered-modal"
      ref="hero-career-mode-selector"
      @ok="openHeroPicker"
      size="large"
    >
      <template #modal-title> Select hero for career mode </template>
      <character-list :value="currentCharacterId" v-model="characterId" />
    </b-modal>

    <b-modal
      class="centered-modal"
      ref="weapon-career-mode-selector"
      @ok="openWeaponPicker"
      size="large"
    >
      <template #modal-title> Select weapon for career mode </template>
      <!-- <nft-list v-model="selectedWeapon"/> -->
      <weapon-grid v-model="weaponId" />
    </b-modal>
  </div>
</template>
<script lang="ts">
import { BModal } from "bootstrap-vue";
import Vue from "vue";
import { mapGetters, mapState, mapActions } from "vuex";
import CharacterList from "../components/smart/CharacterList.vue";
import CharacterArt from "../components/CharacterArt.vue";
import WeaponGrid from "@/components/smart/WeaponGrid.vue";
import WeaponIcon from "@/components/WeaponIcon.vue";
import CharacterRoom from "@/components/CharacterRoom.vue";

// import "@/assets/scss/p2playout/p2pstyle.css";
export default Vue.extend({
  components: {
    CharacterList,
    CharacterArt,
    WeaponGrid,
    CharacterRoom,
    WeaponIcon
  },
  data() {
    return {
      characterId: null,
      weaponId: null,
      selectedCharacter: null,
      selectedWeapon: null,
    };
  },
  watch: {
    characterId(val) {
      this.selectedCharacter = this.characters[val];
    },
    weaponId(val) {
      this.selectedWeapon = this.ownWeapons.find((w: any) => !!w && w.id === val);
    },
  },
  methods: {
    ...mapActions(["createCareerRoom", "getCareerRooms", "getRequests"]),
    openHeroPicker() {
      (this.$refs["hero-career-mode-selector"] as BModal).show();
    },
    openWeaponPicker() {
      (this.$refs["weapon-career-mode-selector"] as BModal).show();
    },
    handleCreateRoom() {
      this.createCareerRoom({
        character: this.characterId,
        weapon: this.weaponId,
        matchReward: 1000,
        totalDeposit: 10000,
      });
    },
  },
  computed: {
    ...mapState(["characters", "currentCharacterId", "careerModeRooms"]),
    ...mapGetters(["currentCharacter", "getCharacterName", "ownWeapons"]),

    character(): any {
      if (!this.currentCharacter) {
        return {
          id: null,
          name: "???",
          level: -1,
          experience: -1,
        };
      }

      const c = this.currentCharacter;

      return {
        id: c.id,
        name: this.getCharacterName(c.id),
        level: c.level,
        experience: c.xp,
      };
    },
  },
  async mounted() {
    await this.getCareerRooms();
    await this.getRequests({roomId: '0'});
  },
});
</script>
